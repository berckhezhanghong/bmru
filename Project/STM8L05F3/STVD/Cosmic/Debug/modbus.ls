   1                     ; C Compiler for STM8 (COSMIC Software)
   2                     ; Generator V4.2.4 - 19 Dec 2007
   3                     ; Optimizer V4.2.4 - 18 Dec 2007
   5                     .const:	section	.text
   6  0000               _auchCRCHi:
   7  0000 00            	dc.b	0
   8  0001 c1            	dc.b	193
   9  0002 81            	dc.b	129
  10  0003 40            	dc.b	64
  11  0004 01            	dc.b	1
  12  0005 c0            	dc.b	192
  13  0006 80            	dc.b	128
  14  0007 41            	dc.b	65
  15  0008 01            	dc.b	1
  16  0009 c0            	dc.b	192
  17  000a 80            	dc.b	128
  18  000b 41            	dc.b	65
  19  000c 00            	dc.b	0
  20  000d c1            	dc.b	193
  21  000e 81            	dc.b	129
  22  000f 40            	dc.b	64
  23  0010 01            	dc.b	1
  24  0011 c0            	dc.b	192
  25  0012 80            	dc.b	128
  26  0013 41            	dc.b	65
  27  0014 00            	dc.b	0
  28  0015 c1            	dc.b	193
  29  0016 81            	dc.b	129
  30  0017 40            	dc.b	64
  31  0018 00            	dc.b	0
  32  0019 c1            	dc.b	193
  33  001a 81            	dc.b	129
  34  001b 40            	dc.b	64
  35  001c 01            	dc.b	1
  36  001d c0            	dc.b	192
  37  001e 80            	dc.b	128
  38  001f 41            	dc.b	65
  39  0020 01            	dc.b	1
  40  0021 c0            	dc.b	192
  41  0022 80            	dc.b	128
  42  0023 41            	dc.b	65
  43  0024 00            	dc.b	0
  44  0025 c1            	dc.b	193
  45  0026 81            	dc.b	129
  46  0027 40            	dc.b	64
  47  0028 00            	dc.b	0
  48  0029 c1            	dc.b	193
  49  002a 81            	dc.b	129
  50  002b 40            	dc.b	64
  51  002c 01            	dc.b	1
  52  002d c0            	dc.b	192
  53  002e 80            	dc.b	128
  54  002f 41            	dc.b	65
  55  0030 00            	dc.b	0
  56  0031 c1            	dc.b	193
  57  0032 81            	dc.b	129
  58  0033 40            	dc.b	64
  59  0034 01            	dc.b	1
  60  0035 c0            	dc.b	192
  61  0036 80            	dc.b	128
  62  0037 41            	dc.b	65
  63  0038 01            	dc.b	1
  64  0039 c0            	dc.b	192
  65  003a 80            	dc.b	128
  66  003b 41            	dc.b	65
  67  003c 00            	dc.b	0
  68  003d c1            	dc.b	193
  69  003e 81            	dc.b	129
  70  003f 40            	dc.b	64
  71  0040 01            	dc.b	1
  72  0041 c0            	dc.b	192
  73  0042 80            	dc.b	128
  74  0043 41            	dc.b	65
  75  0044 00            	dc.b	0
  76  0045 c1            	dc.b	193
  77  0046 81            	dc.b	129
  78  0047 40            	dc.b	64
  79  0048 00            	dc.b	0
  80  0049 c1            	dc.b	193
  81  004a 81            	dc.b	129
  82  004b 40            	dc.b	64
  83  004c 01            	dc.b	1
  84  004d c0            	dc.b	192
  85  004e 80            	dc.b	128
  86  004f 41            	dc.b	65
  87  0050 00            	dc.b	0
  88  0051 c1            	dc.b	193
  89  0052 81            	dc.b	129
  90  0053 40            	dc.b	64
  91  0054 01            	dc.b	1
  92  0055 c0            	dc.b	192
  93  0056 80            	dc.b	128
  94  0057 41            	dc.b	65
  95  0058 01            	dc.b	1
  96  0059 c0            	dc.b	192
  97  005a 80            	dc.b	128
  98  005b 41            	dc.b	65
  99  005c 00            	dc.b	0
 100  005d c1            	dc.b	193
 101  005e 81            	dc.b	129
 102  005f 40            	dc.b	64
 103  0060 00            	dc.b	0
 104  0061 c1            	dc.b	193
 105  0062 81            	dc.b	129
 106  0063 40            	dc.b	64
 107  0064 01            	dc.b	1
 108  0065 c0            	dc.b	192
 109  0066 80            	dc.b	128
 110  0067 41            	dc.b	65
 111  0068 01            	dc.b	1
 112  0069 c0            	dc.b	192
 113  006a 80            	dc.b	128
 114  006b 41            	dc.b	65
 115  006c 00            	dc.b	0
 116  006d c1            	dc.b	193
 117  006e 81            	dc.b	129
 118  006f 40            	dc.b	64
 119  0070 01            	dc.b	1
 120  0071 c0            	dc.b	192
 121  0072 80            	dc.b	128
 122  0073 41            	dc.b	65
 123  0074 00            	dc.b	0
 124  0075 c1            	dc.b	193
 125  0076 81            	dc.b	129
 126  0077 40            	dc.b	64
 127  0078 00            	dc.b	0
 128  0079 c1            	dc.b	193
 129  007a 81            	dc.b	129
 130  007b 40            	dc.b	64
 131  007c 01            	dc.b	1
 132  007d c0            	dc.b	192
 133  007e 80            	dc.b	128
 134  007f 41            	dc.b	65
 135  0080 01            	dc.b	1
 136  0081 c0            	dc.b	192
 137  0082 80            	dc.b	128
 138  0083 41            	dc.b	65
 139  0084 00            	dc.b	0
 140  0085 c1            	dc.b	193
 141  0086 81            	dc.b	129
 142  0087 40            	dc.b	64
 143  0088 00            	dc.b	0
 144  0089 c1            	dc.b	193
 145  008a 81            	dc.b	129
 146  008b 40            	dc.b	64
 147  008c 01            	dc.b	1
 148  008d c0            	dc.b	192
 149  008e 80            	dc.b	128
 150  008f 41            	dc.b	65
 151  0090 00            	dc.b	0
 152  0091 c1            	dc.b	193
 153  0092 81            	dc.b	129
 154  0093 40            	dc.b	64
 155  0094 01            	dc.b	1
 156  0095 c0            	dc.b	192
 157  0096 80            	dc.b	128
 158  0097 41            	dc.b	65
 159  0098 01            	dc.b	1
 160  0099 c0            	dc.b	192
 161  009a 80            	dc.b	128
 162  009b 41            	dc.b	65
 163  009c 00            	dc.b	0
 164  009d c1            	dc.b	193
 165  009e 81            	dc.b	129
 166  009f 40            	dc.b	64
 167  00a0 00            	dc.b	0
 168  00a1 c1            	dc.b	193
 169  00a2 81            	dc.b	129
 170  00a3 40            	dc.b	64
 171  00a4 01            	dc.b	1
 172  00a5 c0            	dc.b	192
 173  00a6 80            	dc.b	128
 174  00a7 41            	dc.b	65
 175  00a8 01            	dc.b	1
 176  00a9 c0            	dc.b	192
 177  00aa 80            	dc.b	128
 178  00ab 41            	dc.b	65
 179  00ac 00            	dc.b	0
 180  00ad c1            	dc.b	193
 181  00ae 81            	dc.b	129
 182  00af 40            	dc.b	64
 183  00b0 01            	dc.b	1
 184  00b1 c0            	dc.b	192
 185  00b2 80            	dc.b	128
 186  00b3 41            	dc.b	65
 187  00b4 00            	dc.b	0
 188  00b5 c1            	dc.b	193
 189  00b6 81            	dc.b	129
 190  00b7 40            	dc.b	64
 191  00b8 00            	dc.b	0
 192  00b9 c1            	dc.b	193
 193  00ba 81            	dc.b	129
 194  00bb 40            	dc.b	64
 195  00bc 01            	dc.b	1
 196  00bd c0            	dc.b	192
 197  00be 80            	dc.b	128
 198  00bf 41            	dc.b	65
 199  00c0 00            	dc.b	0
 200  00c1 c1            	dc.b	193
 201  00c2 81            	dc.b	129
 202  00c3 40            	dc.b	64
 203  00c4 01            	dc.b	1
 204  00c5 c0            	dc.b	192
 205  00c6 80            	dc.b	128
 206  00c7 41            	dc.b	65
 207  00c8 01            	dc.b	1
 208  00c9 c0            	dc.b	192
 209  00ca 80            	dc.b	128
 210  00cb 41            	dc.b	65
 211  00cc 00            	dc.b	0
 212  00cd c1            	dc.b	193
 213  00ce 81            	dc.b	129
 214  00cf 40            	dc.b	64
 215  00d0 01            	dc.b	1
 216  00d1 c0            	dc.b	192
 217  00d2 80            	dc.b	128
 218  00d3 41            	dc.b	65
 219  00d4 00            	dc.b	0
 220  00d5 c1            	dc.b	193
 221  00d6 81            	dc.b	129
 222  00d7 40            	dc.b	64
 223  00d8 00            	dc.b	0
 224  00d9 c1            	dc.b	193
 225  00da 81            	dc.b	129
 226  00db 40            	dc.b	64
 227  00dc 01            	dc.b	1
 228  00dd c0            	dc.b	192
 229  00de 80            	dc.b	128
 230  00df 41            	dc.b	65
 231  00e0 01            	dc.b	1
 232  00e1 c0            	dc.b	192
 233  00e2 80            	dc.b	128
 234  00e3 41            	dc.b	65
 235  00e4 00            	dc.b	0
 236  00e5 c1            	dc.b	193
 237  00e6 81            	dc.b	129
 238  00e7 40            	dc.b	64
 239  00e8 00            	dc.b	0
 240  00e9 c1            	dc.b	193
 241  00ea 81            	dc.b	129
 242  00eb 40            	dc.b	64
 243  00ec 01            	dc.b	1
 244  00ed c0            	dc.b	192
 245  00ee 80            	dc.b	128
 246  00ef 41            	dc.b	65
 247  00f0 00            	dc.b	0
 248  00f1 c1            	dc.b	193
 249  00f2 81            	dc.b	129
 250  00f3 40            	dc.b	64
 251  00f4 01            	dc.b	1
 252  00f5 c0            	dc.b	192
 253  00f6 80            	dc.b	128
 254  00f7 41            	dc.b	65
 255  00f8 01            	dc.b	1
 256  00f9 c0            	dc.b	192
 257  00fa 80            	dc.b	128
 258  00fb 41            	dc.b	65
 259  00fc 00            	dc.b	0
 260  00fd c1            	dc.b	193
 261  00fe 81            	dc.b	129
 262  00ff 40            	dc.b	64
 263  0100               _auchCRCLo:
 264  0100 00            	dc.b	0
 265  0101 c0            	dc.b	192
 266  0102 c1            	dc.b	193
 267  0103 01            	dc.b	1
 268  0104 c3            	dc.b	195
 269  0105 03            	dc.b	3
 270  0106 02            	dc.b	2
 271  0107 c2            	dc.b	194
 272  0108 c6            	dc.b	198
 273  0109 06            	dc.b	6
 274  010a 07            	dc.b	7
 275  010b c7            	dc.b	199
 276  010c 05            	dc.b	5
 277  010d c5            	dc.b	197
 278  010e c4            	dc.b	196
 279  010f 04            	dc.b	4
 280  0110 cc            	dc.b	204
 281  0111 0c            	dc.b	12
 282  0112 0d            	dc.b	13
 283  0113 cd            	dc.b	205
 284  0114 0f            	dc.b	15
 285  0115 cf            	dc.b	207
 286  0116 ce            	dc.b	206
 287  0117 0e            	dc.b	14
 288  0118 0a            	dc.b	10
 289  0119 ca            	dc.b	202
 290  011a cb            	dc.b	203
 291  011b 0b            	dc.b	11
 292  011c c9            	dc.b	201
 293  011d 09            	dc.b	9
 294  011e 08            	dc.b	8
 295  011f c8            	dc.b	200
 296  0120 d8            	dc.b	216
 297  0121 18            	dc.b	24
 298  0122 19            	dc.b	25
 299  0123 d9            	dc.b	217
 300  0124 1b            	dc.b	27
 301  0125 db            	dc.b	219
 302  0126 da            	dc.b	218
 303  0127 1a            	dc.b	26
 304  0128 1e            	dc.b	30
 305  0129 de            	dc.b	222
 306  012a df            	dc.b	223
 307  012b 1f            	dc.b	31
 308  012c dd            	dc.b	221
 309  012d 1d            	dc.b	29
 310  012e 1c            	dc.b	28
 311  012f dc            	dc.b	220
 312  0130 14            	dc.b	20
 313  0131 d4            	dc.b	212
 314  0132 d5            	dc.b	213
 315  0133 15            	dc.b	21
 316  0134 d7            	dc.b	215
 317  0135 17            	dc.b	23
 318  0136 16            	dc.b	22
 319  0137 d6            	dc.b	214
 320  0138 d2            	dc.b	210
 321  0139 12            	dc.b	18
 322  013a 13            	dc.b	19
 323  013b d3            	dc.b	211
 324  013c 11            	dc.b	17
 325  013d d1            	dc.b	209
 326  013e d0            	dc.b	208
 327  013f 10            	dc.b	16
 328  0140 f0            	dc.b	240
 329  0141 30            	dc.b	48
 330  0142 31            	dc.b	49
 331  0143 f1            	dc.b	241
 332  0144 33            	dc.b	51
 333  0145 f3            	dc.b	243
 334  0146 f2            	dc.b	242
 335  0147 32            	dc.b	50
 336  0148 36            	dc.b	54
 337  0149 f6            	dc.b	246
 338  014a f7            	dc.b	247
 339  014b 37            	dc.b	55
 340  014c f5            	dc.b	245
 341  014d 35            	dc.b	53
 342  014e 34            	dc.b	52
 343  014f f4            	dc.b	244
 344  0150 3c            	dc.b	60
 345  0151 fc            	dc.b	252
 346  0152 fd            	dc.b	253
 347  0153 3d            	dc.b	61
 348  0154 ff            	dc.b	255
 349  0155 3f            	dc.b	63
 350  0156 3e            	dc.b	62
 351  0157 fe            	dc.b	254
 352  0158 fa            	dc.b	250
 353  0159 3a            	dc.b	58
 354  015a 3b            	dc.b	59
 355  015b fb            	dc.b	251
 356  015c 39            	dc.b	57
 357  015d f9            	dc.b	249
 358  015e f8            	dc.b	248
 359  015f 38            	dc.b	56
 360  0160 28            	dc.b	40
 361  0161 e8            	dc.b	232
 362  0162 e9            	dc.b	233
 363  0163 29            	dc.b	41
 364  0164 eb            	dc.b	235
 365  0165 2b            	dc.b	43
 366  0166 2a            	dc.b	42
 367  0167 ea            	dc.b	234
 368  0168 ee            	dc.b	238
 369  0169 2e            	dc.b	46
 370  016a 2f            	dc.b	47
 371  016b ef            	dc.b	239
 372  016c 2d            	dc.b	45
 373  016d ed            	dc.b	237
 374  016e ec            	dc.b	236
 375  016f 2c            	dc.b	44
 376  0170 e4            	dc.b	228
 377  0171 24            	dc.b	36
 378  0172 25            	dc.b	37
 379  0173 e5            	dc.b	229
 380  0174 27            	dc.b	39
 381  0175 e7            	dc.b	231
 382  0176 e6            	dc.b	230
 383  0177 26            	dc.b	38
 384  0178 22            	dc.b	34
 385  0179 e2            	dc.b	226
 386  017a e3            	dc.b	227
 387  017b 23            	dc.b	35
 388  017c e1            	dc.b	225
 389  017d 21            	dc.b	33
 390  017e 20            	dc.b	32
 391  017f e0            	dc.b	224
 392  0180 a0            	dc.b	160
 393  0181 60            	dc.b	96
 394  0182 61            	dc.b	97
 395  0183 a1            	dc.b	161
 396  0184 63            	dc.b	99
 397  0185 a3            	dc.b	163
 398  0186 a2            	dc.b	162
 399  0187 62            	dc.b	98
 400  0188 66            	dc.b	102
 401  0189 a6            	dc.b	166
 402  018a a7            	dc.b	167
 403  018b 67            	dc.b	103
 404  018c a5            	dc.b	165
 405  018d 65            	dc.b	101
 406  018e 64            	dc.b	100
 407  018f a4            	dc.b	164
 408  0190 6c            	dc.b	108
 409  0191 ac            	dc.b	172
 410  0192 ad            	dc.b	173
 411  0193 6d            	dc.b	109
 412  0194 af            	dc.b	175
 413  0195 6f            	dc.b	111
 414  0196 6e            	dc.b	110
 415  0197 ae            	dc.b	174
 416  0198 aa            	dc.b	170
 417  0199 6a            	dc.b	106
 418  019a 6b            	dc.b	107
 419  019b ab            	dc.b	171
 420  019c 69            	dc.b	105
 421  019d a9            	dc.b	169
 422  019e a8            	dc.b	168
 423  019f 68            	dc.b	104
 424  01a0 78            	dc.b	120
 425  01a1 b8            	dc.b	184
 426  01a2 b9            	dc.b	185
 427  01a3 79            	dc.b	121
 428  01a4 bb            	dc.b	187
 429  01a5 7b            	dc.b	123
 430  01a6 7a            	dc.b	122
 431  01a7 ba            	dc.b	186
 432  01a8 be            	dc.b	190
 433  01a9 7e            	dc.b	126
 434  01aa 7f            	dc.b	127
 435  01ab bf            	dc.b	191
 436  01ac 7d            	dc.b	125
 437  01ad bd            	dc.b	189
 438  01ae bc            	dc.b	188
 439  01af 7c            	dc.b	124
 440  01b0 b4            	dc.b	180
 441  01b1 74            	dc.b	116
 442  01b2 75            	dc.b	117
 443  01b3 b5            	dc.b	181
 444  01b4 77            	dc.b	119
 445  01b5 b7            	dc.b	183
 446  01b6 b6            	dc.b	182
 447  01b7 76            	dc.b	118
 448  01b8 72            	dc.b	114
 449  01b9 b2            	dc.b	178
 450  01ba b3            	dc.b	179
 451  01bb 73            	dc.b	115
 452  01bc b1            	dc.b	177
 453  01bd 71            	dc.b	113
 454  01be 70            	dc.b	112
 455  01bf b0            	dc.b	176
 456  01c0 50            	dc.b	80
 457  01c1 90            	dc.b	144
 458  01c2 91            	dc.b	145
 459  01c3 51            	dc.b	81
 460  01c4 93            	dc.b	147
 461  01c5 53            	dc.b	83
 462  01c6 52            	dc.b	82
 463  01c7 92            	dc.b	146
 464  01c8 96            	dc.b	150
 465  01c9 56            	dc.b	86
 466  01ca 57            	dc.b	87
 467  01cb 97            	dc.b	151
 468  01cc 55            	dc.b	85
 469  01cd 95            	dc.b	149
 470  01ce 94            	dc.b	148
 471  01cf 54            	dc.b	84
 472  01d0 9c            	dc.b	156
 473  01d1 5c            	dc.b	92
 474  01d2 5d            	dc.b	93
 475  01d3 9d            	dc.b	157
 476  01d4 5f            	dc.b	95
 477  01d5 9f            	dc.b	159
 478  01d6 9e            	dc.b	158
 479  01d7 5e            	dc.b	94
 480  01d8 5a            	dc.b	90
 481  01d9 9a            	dc.b	154
 482  01da 9b            	dc.b	155
 483  01db 5b            	dc.b	91
 484  01dc 99            	dc.b	153
 485  01dd 59            	dc.b	89
 486  01de 58            	dc.b	88
 487  01df 98            	dc.b	152
 488  01e0 88            	dc.b	136
 489  01e1 48            	dc.b	72
 490  01e2 49            	dc.b	73
 491  01e3 89            	dc.b	137
 492  01e4 4b            	dc.b	75
 493  01e5 8b            	dc.b	139
 494  01e6 8a            	dc.b	138
 495  01e7 4a            	dc.b	74
 496  01e8 4e            	dc.b	78
 497  01e9 8e            	dc.b	142
 498  01ea 8f            	dc.b	143
 499  01eb 4f            	dc.b	79
 500  01ec 8d            	dc.b	141
 501  01ed 4d            	dc.b	77
 502  01ee 4c            	dc.b	76
 503  01ef 8c            	dc.b	140
 504  01f0 44            	dc.b	68
 505  01f1 84            	dc.b	132
 506  01f2 85            	dc.b	133
 507  01f3 45            	dc.b	69
 508  01f4 87            	dc.b	135
 509  01f5 47            	dc.b	71
 510  01f6 46            	dc.b	70
 511  01f7 86            	dc.b	134
 512  01f8 82            	dc.b	130
 513  01f9 42            	dc.b	66
 514  01fa 43            	dc.b	67
 515  01fb 83            	dc.b	131
 516  01fc 41            	dc.b	65
 517  01fd 81            	dc.b	129
 518  01fe 80            	dc.b	128
 519  01ff 40            	dc.b	64
 597                     ; 73 uint16 CalCRC(uint8 *puchMsg, uint16 usDataLen )
 597                     ; 74 {	
 598                     .text:	section	.text,new
 599  0000               f_CalCRC:
 601  0000 89            	pushw	x
 602  0001 5204          	subw	sp,#4
 603       00000004      OFST:	set	4
 606                     ; 75 	unsigned char uchCRCHi = 0xFF ; /* high byte of CRC initialized */ 
 608  0003 a6ff          	ld	a,#255
 609  0005 6b01          	ld	(OFST-3,sp),a
 610                     ; 76 	unsigned char uchCRCLo = 0xFF ; /* low byte of CRC initialized */ 
 612  0007 6b02          	ld	(OFST-2,sp),a
 614  0009 2018          	jra	L54
 615  000b               L14:
 616                     ; 83 		i = uchCRCLo ^ *puchMsg++ ;   /* calculate the CRC  */ 
 618  000b 1e05          	ldw	x,(OFST+1,sp)
 619  000d f6            	ld	a,(x)
 620  000e 5c            	incw	x
 621  000f 1f05          	ldw	(OFST+1,sp),x
 622  0011 1802          	xor	a,(OFST-2,sp)
 623  0013 5f            	clrw	x
 624  0014 97            	ld	xl,a
 625  0015 1f03          	ldw	(OFST-1,sp),x
 626                     ; 84 		uchCRCLo = uchCRCHi ^ auchCRCHi[i]; 
 628  0017 d60000        	ld	a,(_auchCRCHi,x)
 629  001a 1801          	xor	a,(OFST-3,sp)
 630  001c 6b02          	ld	(OFST-2,sp),a
 631                     ; 85 		uchCRCHi = auchCRCLo[i] ; 
 633  001e d60100        	ld	a,(_auchCRCLo,x)
 634  0021 6b01          	ld	(OFST-3,sp),a
 635  0023               L54:
 636                     ; 81 	while (usDataLen--) /* pass through message buffer */ 
 638  0023 1e0a          	ldw	x,(OFST+6,sp)
 639  0025 5a            	decw	x
 640  0026 1f0a          	ldw	(OFST+6,sp),x
 641  0028 5c            	incw	x
 642  0029 26e0          	jrne	L14
 643                     ; 88 	u16Tmp = uchCRCLo * 0x100 + uchCRCHi;
 645  002b 7b02          	ld	a,(OFST-2,sp)
 646  002d 97            	ld	xl,a
 647  002e 4f            	clr	a
 648  002f 1b01          	add	a,(OFST-3,sp)
 649  0031 2401          	jrnc	L6
 650  0033 5c            	incw	x
 651  0034               L6:
 652  0034 02            	rlwa	x,a
 653                     ; 90 	return u16Tmp; 
 657  0035 5b06          	addw	sp,#6
 658  0037 87            	retf	
 707                     ; 108 uint8 CRCCheck(uint8 *pu8Data, uint16 u16Len)
 707                     ; 109 {
 708                     .text:	section	.text,new
 709  0000               f_CRCCheck:
 711  0000 89            	pushw	x
 712  0001 5204          	subw	sp,#4
 713       00000004      OFST:	set	4
 716                     ; 112 	if(NULL == pu8Data)
 718  0003 5d            	tnzw	x
 719                     ; 114 		return 0;		
 721  0004 2707          	jreq	LC001
 722                     ; 117 	if(2 >= u16Len)
 724  0006 1e0a          	ldw	x,(OFST+6,sp)
 725  0008 a30003        	cpw	x,#3
 726  000b 2404          	jruge	L57
 727                     ; 119 		return 0;	
 729  000d               LC001:
 732  000d 4f            	clr	a
 734  000e               L41:
 736  000e 5b06          	addw	sp,#6
 737  0010 87            	retf	
 738  0011               L57:
 739                     ; 122 	u16Tmp = CalCRC(pu8Data, (u16Len - 2));
 741  0011 1d0002        	subw	x,#2
 742  0014 89            	pushw	x
 743  0015 1e07          	ldw	x,(OFST+3,sp)
 744  0017 8d000000      	callf	f_CalCRC
 746  001b 5b02          	addw	sp,#2
 747  001d 1f03          	ldw	(OFST-1,sp),x
 748                     ; 124 	if(((pu8Data[u16Len - 2]) == (u16Tmp / 0x100)) && 
 748                     ; 125 	   ((pu8Data[u16Len - 1]) == (u16Tmp % 0x100)))
 750  001f 1e0a          	ldw	x,(OFST+6,sp)
 751  0021 1d0002        	subw	x,#2
 752  0024 72fb05        	addw	x,(OFST+1,sp)
 753  0027 f6            	ld	a,(x)
 754  0028 5f            	clrw	x
 755  0029 97            	ld	xl,a
 756  002a 1603          	ldw	y,(OFST-1,sp)
 757  002c 4f            	clr	a
 758  002d 9001          	rrwa	y,a
 759  002f 90bf01        	ldw	c_y+1,y
 760  0032 b301          	cpw	x,c_y+1
 761  0034 26d7          	jrne	LC001
 763  0036 7b04          	ld	a,(OFST+0,sp)
 764  0038 5f            	clrw	x
 765  0039 02            	rlwa	x,a
 766  003a 1f01          	ldw	(OFST-3,sp),x
 767  003c 1e0a          	ldw	x,(OFST+6,sp)
 768  003e 5a            	decw	x
 769  003f 72fb05        	addw	x,(OFST+1,sp)
 770  0042 f6            	ld	a,(x)
 771  0043 5f            	clrw	x
 772  0044 97            	ld	xl,a
 773  0045 1301          	cpw	x,(OFST-3,sp)
 774  0047 26c4          	jrne	LC001
 775                     ; 127 		return 1;
 777  0049 a601          	ld	a,#1
 779  004b 20c1          	jra	L41
 780                     ; 130 	return 0;
 895                     ; 149 sint16 ModbusParse(uint8 *pu8RecBuf, uint16 u16RecLen, tProtocolInfoDef *ptProtocolInfo)
 895                     ; 150 {
 896                     .text:	section	.text,new
 897  0000               f_ModbusParse:
 899  0000 89            	pushw	x
 900  0001 89            	pushw	x
 901       00000002      OFST:	set	2
 904                     ; 153 	if((NULL == pu8RecBuf) || (NULL == ptProtocolInfo))
 906  0002 5d            	tnzw	x
 907  0003 270b          	jreq	LC002
 909  0005 1e0a          	ldw	x,(OFST+8,sp)
 910                     ; 155 		return -1;
 912  0007 2707          	jreq	LC002
 913                     ; 159 	if(UART_RCV_MAX_LONG < u16RecLen)
 915  0009 1e08          	ldw	x,(OFST+6,sp)
 916  000b a30021        	cpw	x,#33
 917  000e 2506          	jrult	L761
 918                     ; 166 		return -1;
 920  0010               LC002:
 926  0010 aeffff        	ldw	x,#65535
 928  0013               L03:
 930  0013 5b04          	addw	sp,#4
 931  0015 87            	retf	
 932  0016               L761:
 933                     ; 169 	if(!CRCCheck(pu8RecBuf, u16RecLen))
 935  0016 89            	pushw	x
 936  0017 1e05          	ldw	x,(OFST+3,sp)
 937  0019 8d000000      	callf	f_CRCCheck
 939  001d 4d            	tnz	a
 940  001e 85            	popw	x
 941                     ; 177 		return -1;
 943  001f 27ef          	jreq	LC002
 944                     ; 180 	i = 0;
 946  0021 5f            	clrw	x
 947  0022 1f01          	ldw	(OFST-1,sp),x
 948                     ; 181 	ptProtocolInfo->u8ID = *pu8RecBuf;
 950  0024 1e03          	ldw	x,(OFST+1,sp)
 951  0026 f6            	ld	a,(x)
 952  0027 1e0a          	ldw	x,(OFST+8,sp)
 953  0029 f7            	ld	(x),a
 954                     ; 182 	i ++;
 956  002a 1e01          	ldw	x,(OFST-1,sp)
 957  002c 5c            	incw	x
 958  002d 1f01          	ldw	(OFST-1,sp),x
 959                     ; 184 	ptProtocolInfo->u8CommandCode = *(pu8RecBuf + i);
 961  002f 1e03          	ldw	x,(OFST+1,sp)
 962  0031 72fb01        	addw	x,(OFST-1,sp)
 963  0034 f6            	ld	a,(x)
 964  0035 1e0a          	ldw	x,(OFST+8,sp)
 965  0037 e701          	ld	(1,x),a
 966                     ; 185 	i ++;
 968  0039 1e01          	ldw	x,(OFST-1,sp)
 969  003b 5c            	incw	x
 970  003c 1f01          	ldw	(OFST-1,sp),x
 971                     ; 188 	ptProtocolInfo->u16RegisterStartAddr = *(pu8RecBuf + i) * 0x100 + *(pu8RecBuf + i + 1);
 973  003e 1e03          	ldw	x,(OFST+1,sp)
 974  0040 72fb01        	addw	x,(OFST-1,sp)
 975  0043 f6            	ld	a,(x)
 976  0044 97            	ld	xl,a
 977  0045 4f            	clr	a
 978  0046 1603          	ldw	y,(OFST+1,sp)
 979  0048 72f901        	addw	y,(OFST-1,sp)
 980  004b 90eb01        	add	a,(1,y)
 981  004e 2401          	jrnc	L22
 982  0050 5c            	incw	x
 983  0051               L22:
 984  0051 160a          	ldw	y,(OFST+8,sp)
 985  0053 02            	rlwa	x,a
 986  0054 90ef02        	ldw	(2,y),x
 987                     ; 189 	i += 2;
 989  0057 1e01          	ldw	x,(OFST-1,sp)
 990  0059 1c0002        	addw	x,#2
 991  005c 1f01          	ldw	(OFST-1,sp),x
 992                     ; 191 	switch(ptProtocolInfo->u8CommandCode)
 994  005e 1e0a          	ldw	x,(OFST+8,sp)
 995  0060 e601          	ld	a,(1,x)
 997                     ; 235 			return -1;
 998  0062 a003          	sub	a,#3
 999  0064 270a          	jreq	L101
1000  0066 a003          	sub	a,#3
1001  0068 2728          	jreq	L301
1002  006a a00a          	sub	a,#10
1003  006c 2733          	jreq	L501
1006  006e 20a0          	jpf	LC002
1007  0070               L101:
1008                     ; 196 			ptProtocolInfo->u16RegisterNum = *(pu8RecBuf + i) * 0x100 + *(pu8RecBuf + i + 1);
1010  0070 1e03          	ldw	x,(OFST+1,sp)
1011  0072 72fb01        	addw	x,(OFST-1,sp)
1012  0075 f6            	ld	a,(x)
1013  0076 97            	ld	xl,a
1014  0077 4f            	clr	a
1015  0078 1603          	ldw	y,(OFST+1,sp)
1016  007a 72f901        	addw	y,(OFST-1,sp)
1017  007d 90eb01        	add	a,(1,y)
1018  0080 2401          	jrnc	L42
1019  0082 5c            	incw	x
1020  0083               L42:
1021  0083 160a          	ldw	y,(OFST+8,sp)
1022  0085 02            	rlwa	x,a
1023  0086 90ef04        	ldw	(4,y),x
1024                     ; 197 			i += 2;
1026  0089 1e01          	ldw	x,(OFST-1,sp)
1027  008b 1c0002        	addw	x,#2
1028  008e 1f01          	ldw	(OFST-1,sp),x
1029                     ; 199 			break;
1031  0090 2037          	jra	L571
1032  0092               L301:
1033                     ; 205 			ptProtocolInfo->u16RegisterNum = 1;
1035  0092 90ae0001      	ldw	y,#1
1036  0096 ef04          	ldw	(4,x),y
1037                     ; 208 			ptProtocolInfo->pu8Data = pu8RecBuf + i;
1039  0098 1e03          	ldw	x,(OFST+1,sp)
1040  009a 72fb01        	addw	x,(OFST-1,sp)
1041  009d 160a          	ldw	y,(OFST+8,sp)
1042                     ; 210 			break;
1044  009f 2025          	jpf	LC003
1045  00a1               L501:
1046                     ; 216 			ptProtocolInfo->u16RegisterNum = *(pu8RecBuf + i) * 0x100 + *(pu8RecBuf + i + 1);
1048  00a1 1e03          	ldw	x,(OFST+1,sp)
1049  00a3 72fb01        	addw	x,(OFST-1,sp)
1050  00a6 f6            	ld	a,(x)
1051  00a7 97            	ld	xl,a
1052  00a8 4f            	clr	a
1053  00a9 1603          	ldw	y,(OFST+1,sp)
1054  00ab 72f901        	addw	y,(OFST-1,sp)
1055  00ae 90eb01        	add	a,(1,y)
1056  00b1 2401          	jrnc	L62
1057  00b3 5c            	incw	x
1058  00b4               L62:
1059  00b4 160a          	ldw	y,(OFST+8,sp)
1060  00b6 02            	rlwa	x,a
1061  00b7 90ef04        	ldw	(4,y),x
1062                     ; 217 			i += 2;
1064  00ba 1e01          	ldw	x,(OFST-1,sp)
1065  00bc 1c0003        	addw	x,#3
1066                     ; 220 			i++;
1068  00bf 1f01          	ldw	(OFST-1,sp),x
1069                     ; 223 			ptProtocolInfo->pu8Data = pu8RecBuf + i;
1071  00c1 1e03          	ldw	x,(OFST+1,sp)
1072  00c3 72fb01        	addw	x,(OFST-1,sp)
1073  00c6               LC003:
1074  00c6 90ef06        	ldw	(6,y),x
1075                     ; 225 			break;
1077  00c9               L571:
1078                     ; 239 	if(ONE_FRAME_MAX_REG_NUM < ptProtocolInfo->u16RegisterNum)
1080  00c9 90ee04        	ldw	y,(4,y)
1081  00cc 90a30019      	cpw	y,#25
1082                     ; 246 	    return -1;
1084  00d0 2504ac100010  	jruge	LC002
1085                     ; 249 	ptProtocolInfo->u16DataLen = (ptProtocolInfo->u16RegisterNum * 2);
1087  00d6 1e0a          	ldw	x,(OFST+8,sp)
1088  00d8 ee04          	ldw	x,(4,x)
1089  00da 58            	sllw	x
1090  00db 160a          	ldw	y,(OFST+8,sp)
1091  00dd 90ef08        	ldw	(8,y),x
1092                     ; 250 	if((pu8RecBuf + u16RecLen - 2 - ptProtocolInfo->pu8Data) != ptProtocolInfo->u16DataLen)
1094  00e0 1e03          	ldw	x,(OFST+1,sp)
1095  00e2 72fb08        	addw	x,(OFST+6,sp)
1096  00e5 1d0002        	subw	x,#2
1097  00e8 90ee06        	ldw	y,(6,y)
1098  00eb 90bf00        	ldw	c_x,y
1099  00ee 72b00000      	subw	x,c_x
1100  00f2 160a          	ldw	y,(OFST+8,sp)
1101  00f4 90e308        	cpw	x,(8,y)
1102                     ; 257 	    return -1;
1104  00f7 26d9          	jrne	LC002
1105                     ; 260 	return 0;
1107  00f9 5f            	clrw	x
1109  00fa ac130013      	jra	L03
1233                     ; 280 sint16 ModbusBuild(tSendProtocolInfoDef tSendProtocolInfo, uint8 *pu8SendBuf, uint16 *pu16sendLen)
1233                     ; 281 {
1234                     .text:	section	.text,new
1235  0000               f_ModbusBuild:
1237  0000 5204          	subw	sp,#4
1238       00000004      OFST:	set	4
1241                     ; 285 	if((NULL == pu8SendBuf) || (NULL == pu16sendLen))
1243  0002 1e30          	ldw	x,(OFST+44,sp)
1244  0004 2704          	jreq	L162
1246  0006 1e32          	ldw	x,(OFST+46,sp)
1247  0008 2605          	jrne	L752
1248  000a               L162:
1249                     ; 287 		return -1;
1251  000a aeffff        	ldw	x,#65535
1253  000d 2068          	jra	L04
1254  000f               L752:
1255                     ; 290 	i = 0;
1257  000f 5f            	clrw	x
1258  0010 1f03          	ldw	(OFST-1,sp),x
1259                     ; 292 	pu8SendBuf[i] = tSendProtocolInfo.u8ID;
1261  0012 7b08          	ld	a,(OFST+4,sp)
1262  0014 1e30          	ldw	x,(OFST+44,sp)
1263  0016 f7            	ld	(x),a
1264                     ; 293 	i ++;
1266  0017 1e03          	ldw	x,(OFST-1,sp)
1267  0019 5c            	incw	x
1268  001a 1f03          	ldw	(OFST-1,sp),x
1269                     ; 296 	pu8SendBuf[i] = tSendProtocolInfo.u8CommandCode;
1271  001c 7b09          	ld	a,(OFST+5,sp)
1272  001e 1e30          	ldw	x,(OFST+44,sp)
1273  0020 72fb03        	addw	x,(OFST-1,sp)
1274  0023 f7            	ld	(x),a
1275                     ; 297 	i ++;
1277  0024 1e03          	ldw	x,(OFST-1,sp)
1278  0026 5c            	incw	x
1279  0027 1f03          	ldw	(OFST-1,sp),x
1280                     ; 300 	memcpy(&pu8SendBuf[i], tSendProtocolInfo.pu8Data, tSendProtocolInfo.u16DataLen);
1282  0029 1e30          	ldw	x,(OFST+44,sp)
1283  002b 72fb03        	addw	x,(OFST-1,sp)
1284  002e bf00          	ldw	c_x,x
1285  0030 9096          	ldw	y,sp
1286  0032 72a9000e      	addw	y,#OFST+10
1287  0036 90bf00        	ldw	c_y,y
1288  0039 1e2e          	ldw	x,(OFST+42,sp)
1289  003b               L43:
1290  003b 5a            	decw	x
1291  003c 92d600        	ld	a,([c_y.w],x)
1292  003f 92d700        	ld	([c_x.w],x),a
1293  0042 5d            	tnzw	x
1294  0043 26f6          	jrne	L43
1295                     ; 301 	i += tSendProtocolInfo.u16DataLen;
1297  0045 1e03          	ldw	x,(OFST-1,sp)
1298  0047 72fb2e        	addw	x,(OFST+42,sp)
1299  004a 1f03          	ldw	(OFST-1,sp),x
1300                     ; 304 	u16Tmp = CalCRC(pu8SendBuf, i);
1302  004c 89            	pushw	x
1303  004d 1e32          	ldw	x,(OFST+46,sp)
1304  004f 8d000000      	callf	f_CalCRC
1306  0053 5b02          	addw	sp,#2
1307  0055 1f01          	ldw	(OFST-3,sp),x
1308                     ; 305 	pu8SendBuf[i] = u16Tmp / 0x100;
1310  0057 7b01          	ld	a,(OFST-3,sp)
1311  0059 1e30          	ldw	x,(OFST+44,sp)
1312  005b 72fb03        	addw	x,(OFST-1,sp)
1313  005e f7            	ld	(x),a
1314                     ; 306 	i ++;
1316  005f 1e03          	ldw	x,(OFST-1,sp)
1317  0061 5c            	incw	x
1318  0062 1f03          	ldw	(OFST-1,sp),x
1319                     ; 307 	pu8SendBuf[i] = u16Tmp % 0x100;
1321  0064 7b02          	ld	a,(OFST-2,sp)
1322  0066 1e30          	ldw	x,(OFST+44,sp)
1323  0068 72fb03        	addw	x,(OFST-1,sp)
1324  006b f7            	ld	(x),a
1325                     ; 308 	i ++;
1327  006c 1e03          	ldw	x,(OFST-1,sp)
1328  006e 5c            	incw	x
1329  006f 1f03          	ldw	(OFST-1,sp),x
1330                     ; 310 	*pu16sendLen = i;
1332  0071 1e32          	ldw	x,(OFST+46,sp)
1333  0073 1603          	ldw	y,(OFST-1,sp)
1334  0075 ff            	ldw	(x),y
1335                     ; 312 	return 0;
1337  0076 5f            	clrw	x
1339  0077               L04:
1341  0077 5b04          	addw	sp,#4
1342  0079 87            	retf	
1376                     	xdef	_auchCRCLo
1377                     	xdef	_auchCRCHi
1378                     	xdef	f_ModbusBuild
1379                     	xdef	f_ModbusParse
1380                     	xdef	f_CRCCheck
1381                     	xdef	f_CalCRC
1382                     	xref	f_memcpy
1383                     	xref.b	c_x
1384                     	xref.b	c_y
1403                     	end
